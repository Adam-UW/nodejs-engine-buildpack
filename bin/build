#!/usr/bin/env bash
set -eu
set -o pipefail

layers_dir=$1
bp_dir=$(cd $(dirname $0)/..; pwd)
current_dir=$(pwd)

source "$bp_dir/lib/build.sh"

[ -f ./yarn.lock ] && use_yarn=true || use_yarn=false

echo "---> Node.js Buildpack"

rm -rf node_modules

bootstrap_buildpack
export PATH=$bp_dir/bin:$PATH

install_or_reuse_parse_tools "$layers_dir/bin"
export PATH=$layers_dir/bin:$PATH

install_or_reuse_node "$layers_dir/nodejs" $current_dir
export PATH=$layers_dir/nodejs/bin:$PATH

install_or_reuse_yarn "$layers_dir/yarn" $current_dir
export PATH=$layers_dir/yarn/bin:$PATH

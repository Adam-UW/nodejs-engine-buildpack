#!/usr/bin/env bash
set -eu
set -o pipefail

layers_dir=$1
bp_dir=$(cd $(dirname $0)/..; pwd)

source "$bp_dir/lib/build.sh"

[ -f ./yarn.lock ] && use_yarn=true || use_yarn=false

echo "---> Node.js Buildpack"

export PATH=$layers_dir/bin:$bp_dir/bin:$PATH
export PATH=$layers_dir/nodejs/bin:$layers_dir/yarn/bin:$PATH

rm -rf node_modules

bootstrap_buildpack
install_or_reuse_parse_tools "$layers_dir/bin"
install_or_reuse_node "$layers_dir/nodejs"
install_or_reuse_yarn "$layers_dir/yarn"
